{"version":3,"file":"tmc.js","sourceRoot":"","sources":["../../services/tmc.ts"],"names":[],"mappings":"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","sourcesContent":["import axios from \"axios\"\nimport { UserInfo, OrganizationInfo } from \"../domain/UserInfo\"\nimport { getAccessToken } from \"./tmc_completion_script\"\n\nconst BASE_URL = \"https://tmc.mooc.fi\"\n\nexport interface UserFieldValue {\n  id: number\n  user_id: number\n  field_name: string\n  value: string\n  created_at: string\n  updated_at: string\n}\n\nexport default class TmcClient {\n  accessToken: String | null\n\n  constructor(accessToken: String | null = null) {\n    this.accessToken = accessToken\n  }\n\n  async getCurrentUserDetails(): Promise<UserInfo> {\n    const res = await axios.get(\n      `${BASE_URL}/api/v8/users/current?show_user_fields=1&extra_fields=1`,\n      {\n        headers: { Authorization: this.accessToken },\n      },\n    )\n\n    const userInfo = res.data\n    return userInfo\n  }\n\n  async getUserDetailsById(id: Number): Promise<UserInfo> {\n    const res = await axios.get(\n      `${BASE_URL}/api/v8/users/${id}?show_user_fields=1&extra_fields=1`,\n      {\n        headers: { Authorization: `Bearer ${await getAccessToken()}` },\n      },\n    )\n\n    const userInfo = res.data\n    return userInfo\n  }\n\n  async getOrganizations(): Promise<OrganizationInfo[]> {\n    const res = await axios.get(`${BASE_URL}/api/v8/org.json`, {\n      headers: { Authorization: `Bearer ${await getAccessToken()}` },\n    })\n    return res.data\n  }\n\n  async getUserAppDatum(after: string | null): Promise<any[]> {\n    let res\n    if (after != null) {\n      after = await encodeURI(after)\n      res = await axios.get(\n        `${BASE_URL}/api/v8/user_app_datum?after=${after}`,\n        {\n          headers: { Authorization: `Bearer ${await getAccessToken()}` },\n        },\n      )\n    } else {\n      res = await axios.get(`${BASE_URL}/api/v8/user_app_datum`, {\n        headers: { Authorization: `Bearer ${await getAccessToken()}` },\n      })\n    }\n    return res.data\n  }\n\n  async getUserFieldValues(after: string | null): Promise<UserFieldValue[]> {\n    let res\n    if (after != null) {\n      after = await encodeURI(after)\n      res = await axios.get(\n        `${BASE_URL}/api/v8/user_field_value?after=${after}`,\n        {\n          headers: { Authorization: `Bearer ${await getAccessToken()}` },\n        },\n      )\n    } else {\n      res = await axios.get(`${BASE_URL}/api/v8/user_field_value`, {\n        headers: { Authorization: `Bearer ${await getAccessToken()}` },\n      })\n    }\n    return res.data\n  }\n}\n\nexport const getCurrentUserDetails = async (\n  accessToken: string,\n): Promise<UserInfo> => {\n  const res = await axios.get(\n    `${BASE_URL}/api/v8/users/current?show_user_fields=true`,\n    {\n      headers: { Authorization: `Bearer ${accessToken}` },\n    },\n  )\n\n  const userInfo = res.data\n  return userInfo\n}\n"]}