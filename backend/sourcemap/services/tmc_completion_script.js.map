{"version":3,"file":"tmc_completion_script.js","sourceRoot":"","sources":["../../services/tmc_completion_script.ts"],"names":[],"mappings":";;;;AAAA,wDAAyB;AACzB,iCAAiC;AAEjC,IAAI,YAAY,GAAkB,IAAI,CAAA;AAEtC,SAAe,gBAAgB;;;;;;oBAC7B,OAAO,CAAC,GAAG,CAAC,8BAA8B,CAAC,CAAA;;;;oBAExB,qBAAM,kBAAK,CAAC,IAAI,CAC5B,OAAO,CAAC,GAAG,CAAC,QAAQ,iBAAc,EACrC,mBACE,OAAO,CAAC,GAAG,CAAC,iBAAiB,kBAClB,kBAAkB,CAC7B,OAAO,CAAC,GAAG,CAAC,YAAY,IAAI,EAAE,CAC/B,kBAAa,kBAAkB,CAC9B,OAAO,CAAC,GAAG,CAAC,YAAY,IAAI,EAAE,CAC/B,yBAAsB,EACvB;4BACE,OAAO,EAAE;gCACP,cAAc,EAAE,mCAAmC;6BACpD;yBACF,CACF,EAAA;;oBAdK,QAAQ,GAAG,SAchB;oBACD,sBAAO,QAAQ,CAAC,IAAI,CAAC,YAAY,EAAA;;;oBAEjC,OAAO,CAAC,GAAG,CAAC,OAAK,CAAC,CAAA;oBAClB,sBAAO,EAAE,EAAA;;;;;CAEZ;AAED,SAAsB,cAAc;;;;;oBAClC,IAAI,YAAY,EAAE;wBAChB,sBAAO,YAAY,EAAA;qBACpB;oBACc,qBAAM,gBAAgB,EAAE,EAAA;;oBAAvC,YAAY,GAAG,SAAwB,CAAA;oBACvC,sBAAO,YAAY,EAAA;;;;CACpB;AAND,wCAMC;AAED,SAAe,uBAAuB,CAAC,SAAmB;;;;;;;oBACtC,KAAA,CAAA,KAAA,kBAAK,CAAA,CAAC,IAAI,CAAA;0BACvB,OAAO,CAAC,GAAG,CAAC,QAAQ,oFAAiF,EACxG;4BACE,SAAS,EAAE,SAAS;yBACrB;;;;oBAEqC,qBAAM,cAAc,EAAE,EAAA;wBANlD,qBAAM,yBAMd,UAAO,IAAI,gBAAa,GAAE,MAAU,SAAsB,CAAE,KAAE;kCAEjE,EAAA;;oBARK,GAAG,GAAG,SAQX;oBACD,sBAAO,GAAG,CAAC,IAAI,EAAA;;;;CAChB;AAED,MAAM,CAAC,OAAO,GAAG;IACf,cAAc,EAAE,cAAc;IAC9B,uBAAuB,EAAE,uBAAuB;CACjD,CAAA","sourcesContent":["import axios from \"axios\"\n//const axios = require(\"axios\");\n\nlet _accessToken: string | null = null\n\nasync function fetchAccessToken(): Promise<string> {\n  console.log(\"Fetching tmc access token...\")\n  try {\n    const response = await axios.post(\n      `${process.env.TMC_HOST}/oauth/token`,\n      `client_secret=${\n        process.env.TMC_CLIENT_SECRET\n      }&username=${encodeURIComponent(\n        process.env.TMC_USERNAME || \"\",\n      )}&password=${encodeURIComponent(\n        process.env.TMC_PASSWORD || \"\",\n      )}&grant_type=password`,\n      {\n        headers: {\n          \"content-type\": \"application/x-www-form-urlencoded\",\n        },\n      },\n    )\n    return response.data.access_token\n  } catch (error) {\n    console.log(error)\n    return \"\"\n  }\n}\n\nexport async function getAccessToken() {\n  if (_accessToken) {\n    return _accessToken\n  }\n  _accessToken = await fetchAccessToken()\n  return _accessToken\n}\n\nasync function getBasicInfoByUsernames(usernames: string[]) {\n  const res = await axios.post(\n    `${process.env.TMC_HOST}/api/v8/users/basic_info_by_usernames?extra_fields=elements-of-ai&user_fields=1`,\n    {\n      usernames: usernames,\n    },\n    {\n      headers: { Authorization: `Bearer ${await getAccessToken()}` },\n    },\n  )\n  return res.data\n}\n\nmodule.exports = {\n  getAccessToken: getAccessToken,\n  getBasicInfoByUsernames: getBasicInfoByUsernames,\n}\n"]}