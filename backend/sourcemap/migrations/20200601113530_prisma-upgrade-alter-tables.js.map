{"version":3,"file":"20200601113530_prisma-upgrade-alter-tables.js","sourceRoot":"","sources":["../../migrations/20200601113530_prisma-upgrade-alter-tables.ts"],"names":[],"mappings":";;;;AAEA,SAAsB,EAAE,CAAC,IAAU;;;;;gBACjC,cAAc;gBACd,qEAAqE;gBACrE,mGAAmG;gBACnG;;;;;;;;mBAQG;gBAEH,QAAQ;gBACR,qBAAM,IAAI,CAAC,GAAG,CACZ,uEAAqE,CACtE,EAAA;;oBAhBD,cAAc;oBACd,qEAAqE;oBACrE,mGAAmG;oBACnG;;;;;;;;uBAQG;oBAEH,QAAQ;oBACR,SAEC,CAAA;oBACD,qBAAM,IAAI,CAAC,GAAG,CACZ,uFAAqF,CACtF;wBAED,4BAA4B;wBAE5B;;;;;2BAKG;wBAEH,WAAW;sBAXV;;oBAFD,SAEC,CAAA;oBAED,4BAA4B;oBAE5B;;;;;uBAKG;oBAEH,WAAW;oBACX,qBAAM,IAAI,CAAC,GAAG,CACZ,8EAA4E,CAC7E,EAAA;;oBAZD,4BAA4B;oBAE5B;;;;;uBAKG;oBAEH,WAAW;oBACX,SAEC,CAAA;oBACD,qBAAM,IAAI,CAAC,GAAG,CACZ,wEAAsE,CACvE,EAAA;;oBAFD,SAEC,CAAA;oBACD,qBAAM,IAAI,CAAC,GAAG,CACZ,oEAAkE,CACnE,EAAA;;oBAFD,SAEC,CAAA;oBACD,qBAAM,IAAI,CAAC,GAAG,CACZ,sEAAoE,CACrE,EAAA;;oBAFD,SAEC,CAAA;oBACD,qBAAM,IAAI,CAAC,GAAG,CACZ,qEAAmE,CACpE,EAAA;;oBAFD,SAEC,CAAA;oBACD,qBAAM,IAAI,CAAC,GAAG,CACZ,kEAAgE,CACjE,EAAA;;oBAFD,SAEC,CAAA;oBACD,qBAAM,IAAI,CAAC,GAAG,CACZ,+EAA6E,CAC9E,EAAA;;oBAFD,SAEC,CAAA;oBACD,qBAAM,IAAI,CAAC,GAAG,CACZ,4EAA0E,CAC3E;wBAED,sBAAsB;sBAFrB;;oBAFD,SAEC,CAAA;oBAED,sBAAsB;oBACtB,qBAAM,IAAI,CAAC,GAAG,CACZ,uFAAmF,CACpF,EAAA;;oBAHD,sBAAsB;oBACtB,SAEC,CAAA;oBACD,qBAAM,IAAI,CAAC,GAAG,CACZ,kGAA8F,CAC/F,EAAA;;oBAFD,SAEC,CAAA;oBACD,qBAAM,IAAI,CAAC,GAAG,CACZ,mFAA+E,CAChF,EAAA;;oBAFD,SAEC,CAAA;oBACD,qBAAM,IAAI,CAAC,GAAG,CACZ,yFAAqF,CACtF,EAAA;;oBAFD,SAEC,CAAA;oBACD,qBAAM,IAAI,CAAC,GAAG,CACZ,gGAA4F,CAC7F,EAAA;;oBAFD,SAEC,CAAA;oBACD,qBAAM,IAAI,CAAC,GAAG,CACZ,+FAA2F,CAC5F,EAAA;;oBAFD,SAEC,CAAA;oBACD,qBAAM,IAAI,CAAC,GAAG,CACZ,2FAAuF,CACxF,EAAA;;oBAFD,SAEC,CAAA;oBACD,qBAAM,IAAI,CAAC,GAAG,CACZ,2FAAuF,CACxF,EAAA;;oBAFD,SAEC,CAAA;oBACD,qBAAM,IAAI,CAAC,GAAG,CACZ,2FAAuF,CACxF,EAAA;;oBAFD,SAEC,CAAA;oBACD,qBAAM,IAAI,CAAC,GAAG,CACZ,qFAAiF,CAClF,EAAA;;oBAFD,SAEC,CAAA;oBACD,qBAAM,IAAI,CAAC,GAAG,CACZ,gGAA4F,CAC7F,EAAA;;oBAFD,SAEC,CAAA;oBACD,qBAAM,IAAI,CAAC,GAAG,CACZ,kFAA8E,CAC/E,EAAA;;oBAFD,SAEC,CAAA;oBACD,qBAAM,IAAI,CAAC,GAAG,CACZ,8GAA0G,CAC3G,EAAA;;oBAFD,SAEC,CAAA;oBACD,qBAAM,IAAI,CAAC,GAAG,CACZ,yFAAqF,CACtF,EAAA;;oBAFD,SAEC,CAAA;oBACD,qBAAM,IAAI,CAAC,GAAG,CACZ,qGAAiG,CAClG,EAAA;;oBAFD,SAEC,CAAA;oBACD,qBAAM,IAAI,CAAC,GAAG,CACZ,oFAAgF,CACjF,EAAA;;oBAFD,SAEC,CAAA;oBACD,qBAAM,IAAI,CAAC,GAAG,CACZ,yFAAqF,CACtF,EAAA;;oBAFD,SAEC,CAAA;oBACD,qBAAM,IAAI,CAAC,GAAG,CACZ,qGAAiG,CAClG,EAAA;;oBAFD,SAEC,CAAA;oBACD,qBAAM,IAAI,CAAC,GAAG,CACZ,iFAA6E,CAC9E,EAAA;;oBAFD,SAEC,CAAA;oBACD,qBAAM,IAAI,CAAC,GAAG,CACZ,+FAA2F,CAC5F,EAAA;;oBAFD,SAEC,CAAA;oBACD,qBAAM,IAAI,CAAC,GAAG,CACZ,iGAA6F,CAC9F,EAAA;;oBAFD,SAEC,CAAA;oBACD,qBAAM,IAAI,CAAC,GAAG,CACZ,yGAAqG,CACtG,EAAA;;oBAFD,SAEC,CAAA;oBACD,qBAAM,IAAI,CAAC,GAAG,CACZ,+FAA2F,CAC5F,EAAA;;oBAFD,SAEC,CAAA;oBACD,qBAAM,IAAI,CAAC,GAAG,CACZ,4GAAwG,CACzG,EAAA;;oBAFD,SAEC,CAAA;oBACD,qBAAM,IAAI,CAAC,GAAG,CACZ,8FAA0F,CAC3F,EAAA;;oBAFD,SAEC,CAAA;oBACD,qBAAM,IAAI,CAAC,GAAG,CACZ,0FAAsF,CACvF,EAAA;;oBAFD,SAEC,CAAA;;;;;CACF;AAxID,gBAwIC;AAED,SAAsB,IAAI,CAAC,KAAW;;;;CAAkB;AAAxD,oBAAwD","sourcesContent":["import * as Knex from \"knex\"\n\nexport async function up(knex: Knex): Promise<any> {\n  // JSON fields\n  // note: the old backend doesn't work properly if these are altered -\n  // the new one doesn't really care, so best not change them until the old one is not in use anymore\n  /*await knex.raw(\n    `ALTER TABLE \"user_course_progress\" ALTER COLUMN progress TYPE JSON USING \"progress\"::json;`,\n  )\n  await knex.raw(\n    `ALTER TABLE \"user_course_service_progress\" ALTER COLUMN progress TYPE JSON USING \"progress\"::json;`,\n  )\n  await knex.raw(\n    `ALTER TABLE \"UserCourseSettings\" ALTER COLUMN other TYPE JSON using \"other\"::json;`,\n  )*/\n\n  // enums\n  await knex.raw(\n    `CREATE TYPE \"CourseStatus\" AS ENUM ('Active', 'Ended', 'Upcoming');`,\n  )\n  await knex.raw(\n    `CREATE TYPE \"OrganizationRole\" AS ENUM ('OrganizationAdmin', 'Student', 'Teacher');`,\n  )\n\n  // note: same as json fields\n\n  /*await knex.raw(\n    `ALTER TABLE \"course\" ALTER COLUMN \"status\" TYPE \"CourseStatus\" USING \"status\"::\"CourseStatus\";`,\n  )\n  await knex.raw(\n    `ALTER TABLE \"user_organization\" ALTER COLUMN \"role\" TYPE \"OrganizationRole\" USING \"role\"::\"OrganizationRole\";`,\n  )*/\n\n  // defaults\n  await knex.raw(\n    `ALTER TABLE \"course\" ALTER COLUMN automatic_completions SET DEFAULT false;`,\n  )\n  await knex.raw(\n    `ALTER TABLE \"course\" ALTER COLUMN has_certificate SET DEFAULT false;`,\n  )\n  await knex.raw(\n    `ALTER TABLE \"course\" ALTER COLUMN status SET DEFAULT 'Upcoming';`,\n  )\n  await knex.raw(\n    `ALTER TABLE \"email_delivery\" ALTER COLUMN error SET DEFAULT false;`,\n  )\n  await knex.raw(\n    `ALTER TABLE \"email_delivery\" ALTER COLUMN sent SET DEFAULT false;`,\n  )\n  await knex.raw(\n    `ALTER TABLE \"exercise\" ALTER COLUMN deleted SET DEFAULT false;`,\n  )\n  await knex.raw(\n    `ALTER TABLE \"exercise_completion\" ALTER COLUMN completed SET DEFAULT false;`,\n  )\n  await knex.raw(\n    `ALTER TABLE \"user_organization\" ALTER COLUMN role SET DEFAULT 'Student';`,\n  )\n\n  // created_at defaults\n  await knex.raw(\n    `ALTER TABLE \"completion\" ALTER COLUMN \"created_at\" SET DEFAULT CURRENT_TIMESTAMP;`,\n  )\n  await knex.raw(\n    `ALTER TABLE \"completion_registered\" ALTER COLUMN \"created_at\" SET DEFAULT CURRENT_TIMESTAMP;`,\n  )\n  await knex.raw(\n    `ALTER TABLE \"course\" ALTER COLUMN \"created_at\" SET DEFAULT CURRENT_TIMESTAMP;`,\n  )\n  await knex.raw(\n    `ALTER TABLE \"course_alias\" ALTER COLUMN \"created_at\" SET DEFAULT CURRENT_TIMESTAMP;`,\n  )\n  await knex.raw(\n    `ALTER TABLE \"course_organization\" ALTER COLUMN \"created_at\" SET DEFAULT CURRENT_TIMESTAMP;`,\n  )\n  await knex.raw(\n    `ALTER TABLE \"course_translation\" ALTER COLUMN \"created_at\" SET DEFAULT CURRENT_TIMESTAMP;`,\n  )\n  await knex.raw(\n    `ALTER TABLE \"course_variant\" ALTER COLUMN \"created_at\" SET DEFAULT CURRENT_TIMESTAMP;`,\n  )\n  await knex.raw(\n    `ALTER TABLE \"email_delivery\" ALTER COLUMN \"created_at\" SET DEFAULT CURRENT_TIMESTAMP;`,\n  )\n  await knex.raw(\n    `ALTER TABLE \"email_template\" ALTER COLUMN \"created_at\" SET DEFAULT CURRENT_TIMESTAMP;`,\n  )\n  await knex.raw(\n    `ALTER TABLE \"exercise\" ALTER COLUMN \"created_at\" SET DEFAULT CURRENT_TIMESTAMP;`,\n  )\n  await knex.raw(\n    `ALTER TABLE \"exercise_completion\" ALTER COLUMN \"created_at\" SET DEFAULT CURRENT_TIMESTAMP;`,\n  )\n  await knex.raw(\n    `ALTER TABLE \"image\" ALTER COLUMN \"created_at\" SET DEFAULT CURRENT_TIMESTAMP;`,\n  )\n  await knex.raw(\n    `ALTER TABLE \"open_university_registration_link\" ALTER COLUMN \"created_at\" SET DEFAULT CURRENT_TIMESTAMP;`,\n  )\n  await knex.raw(\n    `ALTER TABLE \"organization\" ALTER COLUMN \"created_at\" SET DEFAULT CURRENT_TIMESTAMP;`,\n  )\n  await knex.raw(\n    `ALTER TABLE \"organization_translation\" ALTER COLUMN \"created_at\" SET DEFAULT CURRENT_TIMESTAMP;`,\n  )\n  await knex.raw(\n    `ALTER TABLE \"service\" ALTER COLUMN \"created_at\" SET DEFAULT CURRENT_TIMESTAMP;`,\n  )\n  await knex.raw(\n    `ALTER TABLE \"study_module\" ALTER COLUMN \"created_at\" SET DEFAULT CURRENT_TIMESTAMP;`,\n  )\n  await knex.raw(\n    `ALTER TABLE \"study_module_translation\" ALTER COLUMN \"created_at\" SET DEFAULT CURRENT_TIMESTAMP;`,\n  )\n  await knex.raw(\n    `ALTER TABLE \"user\" ALTER COLUMN \"created_at\" SET DEFAULT CURRENT_TIMESTAMP;`,\n  )\n  await knex.raw(\n    `ALTER TABLE \"UserAppDatumConfig\" ALTER COLUMN \"created_at\" SET DEFAULT CURRENT_TIMESTAMP;`,\n  )\n  await knex.raw(\n    `ALTER TABLE \"user_course_progress\" ALTER COLUMN \"created_at\" SET DEFAULT CURRENT_TIMESTAMP;`,\n  )\n  await knex.raw(\n    `ALTER TABLE \"user_course_service_progress\" ALTER COLUMN \"created_at\" SET DEFAULT CURRENT_TIMESTAMP;`,\n  )\n  await knex.raw(\n    `ALTER TABLE \"UserCourseSettings\" ALTER COLUMN \"created_at\" SET DEFAULT CURRENT_TIMESTAMP;`,\n  )\n  await knex.raw(\n    `ALTER TABLE \"user_course_settings_visibility\" ALTER COLUMN \"created_at\" SET DEFAULT CURRENT_TIMESTAMP;`,\n  )\n  await knex.raw(\n    `ALTER TABLE \"user_organization\" ALTER COLUMN \"created_at\" SET DEFAULT CURRENT_TIMESTAMP;`,\n  )\n  await knex.raw(\n    `ALTER TABLE \"verified_user\" ALTER COLUMN \"created_at\" SET DEFAULT CURRENT_TIMESTAMP;`,\n  )\n}\n\nexport async function down(_knex: Knex): Promise<any> {}\n"]}