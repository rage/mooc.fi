{"version":3,"file":"removeDuplicateCompletions.js","sourceRoot":"","sources":["../../bin/removeDuplicateCompletions.ts"],"names":[],"mappings":";;;AAAA,kEAAmC;AAEnC,IAAM,0BAA0B,GAAG;;;oBACjC,qBAAM,iBAAI,CAAC,GAAG,CAAC,+zBAoBZ,CAAC,EAAA;;gBApBJ,SAoBI,CAAA;;;;KACL,CAAA;AAED,0BAA0B,EAAE,CAAA","sourcesContent":["import Knex from \"../services/knex\"\n\nconst removeDuplicateCompletions = async () => {\n  await Knex.raw(`\n        DELETE\n        FROM completion\n        WHERE id IN (SELECT id\n                    FROM completion\n                    WHERE course = '55dff8af-c06c-4a97-88e6-af7c04d252ca'\n                    AND id IN (\n                        SELECT id\n                        FROM (\n                                SELECT id,\n                                        row_number() OVER (\n                                            PARTITION BY \"user\",\n                                                course\n                                            ORDER BY\n                                                created_at\n                                            ) rn\n                                FROM completion\n                            ) s\n                        WHERE rn != 1\n                    ))\n    `)\n}\n\nremoveDuplicateCompletions()\n"]}